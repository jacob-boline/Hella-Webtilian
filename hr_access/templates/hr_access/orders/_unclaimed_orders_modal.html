{# hr_access/templates/hr_access/_unclaimed_orders_modal.html #}

<div class="modal-panel unclaimed-orders-modal">
  <h2 class="sub-header modal-title">Unclaimed orders</h2>

  {% if claimed_count %}
    <div class="form-errors is-success">
      <p>Claimed {{ claimed_count }} order{{ claimed_count|pluralize }}.</p>
    </div>
  {% endif %}

  {% if error %}
    <div class="form-errors">
      <p>{{ error }}</p>
    </div>
  {% endif %}

  {% if not email %}
    <p class="modal-text-muted">No email found for your account.</p>
  {% else %}
    <p class="modal-text-muted">
      Showing unclaimed orders associated with <strong>{{ email }}</strong>.
    </p>

    {% if orders %}
      <form
        method="post"
        hx-post="{% url 'hr_access:account_submit_claim_unclaimed_orders' %}"
        hx-target="#modal-content"
        hx-swap="innerHTML transition:true">

        {% csrf_token %}

        <div class="modal-actions" style="justify-content: flex-start;">
          <label class="modal-text-muted" style="display:flex; align-items:center; gap:0.5rem;">
            <input type="checkbox" id="select-all-unclaimed">
            Select all
          </label>
        </div>

        <div class="order-claim-list">
          {% for o in orders %}
            <label class="order-claim-row">
              <input
                type="checkbox"
                name="order_ids"
                value="{{ o.id }}"
                class="unclaimed-order-checkbox">

              <span class="order-claim-id">#{{ o.id }}</span>
              <span class="order-claim-meta">{{ o.created_at|date:"M j, Y g:i A" }}</span>
              <span class="order-claim-meta">${{ o.total|floatformat:2 }}</span>
              <span class="order-claim-meta">{{ o.payment_status }}</span>
              <span class="order-claim-meta">{{ o.order_status }}</span>
            </label>
          {% endfor %}
        </div>

        <div class="modal-actions stack uniform">
          <button type="submit" class="card-btn btn-neon btn-blue">Claim selected</button>
          <button type="button" class="card-btn btn-neon btn-yellow" data-modal-close>Not now</button>
        </div>
      </form>

      <script>
        (function () {
          const selectAll = document.getElementById("select-all-unclaimed");
          const boxes = document.querySelectorAll(".unclaimed-order-checkbox");
          if (!selectAll || !boxes.length) return;

          selectAll.addEventListener("change", () => {
            boxes.forEach(b => { b.checked = selectAll.checked; });
          });
        })();
      </script>
    {% else %}
      <p class="modal-text-muted">No unclaimed orders found for this email.</p>

      <div class="modal-actions stack uniform">
        <button type="button" class="card-btn btn-neon btn-blue" data-modal-close>
          Close
        </button>
      </div>
    {% endif %}
  {% endif %}
</div>
