{# hr_shop/templates/hr_shop/_merch_grid.html #}

{% load static %}
{% load shop_tags shop_images %}


<div id="merch-grid">
    {% for product in products %}
        {% get_display_variant product as display_variant %}
        {% if display_variant %}
            {% variant_image display_variant as display_image %}
            <article class="merch-card" data-sku="{{ display_variant.sku }}">

                {# --- Clickable product image --- #}
                <button class="merch-img"
                        aria-label="Open details for {{ product.name }}{% if display_variant.name %} ({{ display_variant.name }}){% endif %}"
                        hx-get="{% url 'hr_shop:product_modal_partial' product_slug=product.slug %}"
                        hx-target="#modal-content">

{#                    {% if display_image %}#}
{#                        <img src="{{ display_image.image.url }}"#}
{#                             alt="{{ product.name }}{% if display_variant.name %} ({{ display_variant.name }}){% endif %}"#}
{#                             class="merch-thumb-img">#}
{#                    {% else %}#}
{#                        <img src="{% static 'hr_shop/img/placeholder_2.png' %}"#}
{#                             alt="{{ product.name }}{% if display_variant.name %} ({{ display_variant.name }}){% endif %}"#}
{#                             class="merch-thumb-img">#}
{#                    {% endif %}#}
                </button>

                {# --- Title + Price --- #}
                <div class="merch-meta">
                    <h3 class="merch-title">
                        {{ product.name }}{% if display_variant.name %} ({{ display_variant.name }}){% endif %}
                    </h3>
                    <div class="merch-price">
                        ${{ display_variant.price }}
                    </div>
                </div>

                {# --- Buttons: Details on left / Buy on right --- #}
                <div class="merch-actions">

                    <button class="merch-card-btn outline"
                            hx-get="{% url 'hr_shop:product_modal_partial' product_slug=product.slug %}"
                            hx-target="#modal-content"
                            hx-swap="innerHTML">
                        <i class="fas fa-circle-info"></i> Details
                    </button>

                    <button class="merch-card-btn buy-button"
                            hx-post="{% url 'hr_shop:add_to_cart' variant_slug=display_variant.slug %}"
                            hx-vals='{"quantity": 1}'
                            hx-swap="none">
                        <i class="fas fa-cart-plus"></i> Buy
                    </button>

                </div>

            </article>
        {% endif %}
    {% endfor %}
</div>
