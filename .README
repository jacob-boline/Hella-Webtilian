DEV RUN ORDER:

    1) stripe listen --forward-to localhost:8000/payment/webhooks/stripe/
    2) docker start redis  (or docker run -d --name redis -p 6379:6379 redis:7-alpine)
        - test with "docker exec -it redis redis-cli ping"
    3) Add redis worker:
        - "python manage.py rqworker default --worker-class rq.worker.SimpleWorker"
    3) If first run (or to reset environment) "python manage.py init"
    4) seed non-model media (backgrounds/wipes) "python manage.py seed_media_assets"
    5) process wipe/bg images "python manage.py media_sweep"
    6) start vite "npm run vite:dev"
    7) start in debug
    8) optional: nginx dev proxy (media only; Vite serves static) at http://localhost:8080

 Create apps + models above; run migrations

 Admin: register models; create superuser

 Implement fake payment gateway + mock checkout page

 Webhook: accept fake payload, mark order paid, store WebhookEvent

 Shows: list/detail + .ics

 Bulletin: list (HTMX infinite) + detail

 Accounts: login (or magic link) + auto-link account_get_orders by email

 Dual-render helper + account_get_orders modal wired

 Tests: the 6–8 listed

 Add a couple of real-looking seed entries (2 shows, 3 posts, 2 products/variants)

 Dockerize and Deploy:  ; set ALLOWED_HOSTS, SECURE_PROXY_SSL_HEADER, CSP, SECRET_KEY


 ==========================================================================================================

 seed the dev db:

        python manage.py init  (full nuke and rebuild)

        flags (can be combined):

        --no-input (skip confirmation)

        --no-npm   (skips 'npm run dev' which runs the app with livereload)

        --no-seed  (skips seeding/populating the DB)

        To seed non-model media only:

        python manage.py seed_data --media

 ==========================================================================================================


# Hella Webtilian developer notes

==========================
==========================
## Media pipeline overview (5 image types)

The project uses two pipelines depending on whether an image is model-backed (ImageField) or a repo static asset. The five image “types” are:

1) **Post hero images (`Post`)**
   - **Source**: `MEDIA_ROOT/posts/hero/...` seeded via model data or uploads.
   - **Pipeline**: ImageField save triggers app signal → `hr_core.media_jobs` recipe `post_hero` generates `opt` WebP variants (640–1600w) under the same media folder tree.
   - **Runtime**: Template tags in `hr_core/templatetags/responsive_images.py` build `srcset` URLs for `/media/.../opt/...`.

2) **Product images (`ProductImage`)**
   - **Source**: `MEDIA_ROOT/variants/...` seeded via model data or uploads.
   - **Pipeline**: ImageField save triggers app signal → recipe `variant` generates `opt_webp` WebP variants (256–768w).
   - **Runtime**: Template tags build `srcset` URLs for `/media/.../opt_webp/...`.

3) **Carousel slides (`CarouselSlide`)**
   - **Source**: `MEDIA_ROOT/hr_about/...` seeded via model data or uploads.
   - **Pipeline**: ImageField save triggers app signal → recipe `about` generates `opt_webp` WebP variants (640–1920w).
   - **Runtime**: Template tags build `srcset` URLs for `/media/.../opt_webp/...`.

4) **Section backgrounds (parallax)**
   - **Source**: Repo static assets seeded to `hr_core/static/hr_core/images/backgrounds/...` via `python manage.py seed_media_assets`.
   - **Pipeline**: `python manage.py media_sweep` enqueues `bg_section` jobs; `hr_core.media_jobs` writes `bg_opt` WebP variants alongside sources in the repo static tree.
   - **Runtime**: `python manage.py build_responsive_backgrounds` reads `hr_core/config/backgrounds_config.py` and writes generated CSS with `/static/hr_core/images/backgrounds/...` URLs.

5) **Section wipes**
   - **Source**: Repo static assets seeded to `hr_core/static/hr_core/images/wipes/...` via `python manage.py seed_media_assets`.
   - **Pipeline**: `python manage.py media_sweep` enqueues `wipe_section` jobs; `hr_core.media_jobs` writes `opt_webp` WebP variants alongside sources in the repo static tree.
   - **Runtime**: `python manage.py build_responsive_backgrounds` reads `hr_core/config/backgrounds_config.py` and writes generated CSS with `/static/hr_core/images/wipes/...` URLs.

==========================
==========================
## SMTP configuration

- **Default provider:** Mailjet. Switch to Zoho with `EMAIL_PROVIDER=zoho`.
- **Global overrides:** `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_USE_TLS`, `EMAIL_USE_SSL`, `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD`, `DEFAULT_FROM_EMAIL`.
- **Provider-specific overrides (checked first by the health check):**
  - Mailjet: `MAILJET_EMAIL_HOST`, `MAILJET_EMAIL_PORT`, `MAILJET_EMAIL_USE_TLS`, `MAILJET_EMAIL_USE_SSL`, `MAILJET_EMAIL_HOST_USER`, `MAILJET_EMAIL_HOST_PASSWORD`.
  - Zoho: `ZOHO_EMAIL_HOST`, `ZOHO_EMAIL_PORT`, `ZOHO_EMAIL_USE_TLS`, `ZOHO_EMAIL_USE_SSL`, `ZOHO_EMAIL_HOST_USER`, `ZOHO_EMAIL_HOST_PASSWORD`.
- **Health check recipient:** `EMAIL_HEALTHCHECK_RECIPIENT` (or pass `--to`).


==========================
==========================
## SMTP health check

Send a disposable test email through every configured provider:

```bash
python manage.py send_email_healthcheck --to someone+test@example.com
```

You can target one backend with `--provider mailjet` or `--provider zoho`. The command uses provider-prefixed environment variables first, then falls back to global `EMAIL_*` values.

==========================
==========================
## Checkout email flow verification

- Run tests for the email provider parsing and checkout confirmation flow:

```bash
python manage.py test hr_email hr_shop
```

- When exercising the flow manually, watch the server logs for rate-limit warnings emitted from `hr_shop/services/email_confirmation.py` if you trigger multiple sends in a short window.

 ==========================================================================================================
