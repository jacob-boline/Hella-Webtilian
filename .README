DEV RUN ORDER:

    1) stripe listen --forward-to localhost:8000/payment/webhooks/stripe/
    2) docker start redis  (or docker run -d --name redis -p 6379:6379 redis:7-alpine)
        - test with "docker exec -it redis redis-cli ping"
    3) Add redis worker:
        - "python manage.py rqworker default --worker-class rq.worker.SimpleWorker"
    3) If first run (or to reset environment) "python manage.py init"
    4) seed non-model media (backgrounds/wipes) "python manage.py seed_media_assets"
    5) process wipe/bg images "python manage.py media_sweep"
    6) start vite "npm run vite:dev"
    7) start in debug
    8) optional: nginx dev proxy (media only; Vite serves static) at http://localhost:8080

 Create apps + models above; run migrations

 Admin: register models; create superuser

 Implement fake payment gateway + mock checkout page

 Webhook: accept fake payload, mark order paid, store WebhookEvent

 Shows: list/detail + .ics

 Bulletin: list (HTMX infinite) + detail

 Accounts: login (or magic link) + auto-link account_get_orders by email

 Dual-render helper + account_get_orders modal wired

 Tests: the 6–8 listed

 Add a couple of real-looking seed entries (2 shows, 3 posts, 2 products/variants)

 Dockerize and Deploy:  ; set ALLOWED_HOSTS, SECURE_PROXY_SSL_HEADER, CSP, SECRET_KEY


 ==========================================================================================================

 seed the dev db:

        python manage.py init  (full nuke and rebuild)

        flags (can be combined):

        --no-input (skip confirmation)

        --no-npm   (skips 'npm run dev' which runs the app with livereload)

        --no-seed  (skips seeding/populating the DB)

        To seed non-model media only:

        python manage.py seed_data --media

 ==========================================================================================================


# Hella Webtilian developer notes

==========================
==========================
## Media pipeline overview (5 image types)

The app handles five image types. Three are model-backed ImageFields that flow through the media pipeline, and two are repo static assets (backgrounds/wipes) that flow through the static pipeline.

**Post hero images (`Post`).** These live under `MEDIA_ROOT/posts/hero/...` from seed data or uploads. When a `Post` image is saved, its app signal triggers the `post_hero` recipe in `hr_core.media_jobs`, which generates `opt` WebP variants (640–1600w) next to the source. Templates use the `responsive_images` template tags to build `/media/.../opt/...` `srcset` URLs.

**Product images (`ProductImage`).** These live under `MEDIA_ROOT/variants/...`. Saving the ImageField triggers the `variant` recipe, producing `opt_webp` variants (256–768w) alongside the original. Templates build `/media/.../opt_webp/...` `srcset` URLs.

**Carousel slides (`CarouselSlide`).** These live under `MEDIA_ROOT/hr_about/...`. Saving the ImageField triggers the `about` recipe, producing `opt_webp` variants (640–1920w). Templates build `/media/.../opt_webp/...` `srcset` URLs.

**Section backgrounds (parallax).** These are repo static assets seeded into `hr_core/static/hr_core/images/backgrounds/...` via `python manage.py seed_media_assets`. When you run `python manage.py media_sweep`, it enqueues the `bg_section` recipe to generate `bg_opt` WebP variants alongside the sources in the repo static tree. `python manage.py build_responsive_backgrounds` reads `hr_core/config/backgrounds_config.py` and generates CSS that references `/static/hr_core/images/backgrounds/...` URLs.

**Section wipes.** These are repo static assets seeded into `hr_core/static/hr_core/images/wipes/...` via `python manage.py seed_media_assets`. `python manage.py media_sweep` enqueues the `wipe_section` recipe, which generates `opt_webp` WebP variants next to the originals. `python manage.py build_responsive_backgrounds` reads `hr_core/config/backgrounds_config.py` and generates CSS that references `/static/hr_core/images/wipes/...` URLs.

==========================
==========================
## SMTP configuration

- **Default provider:** Mailjet. Switch to Zoho with `EMAIL_PROVIDER=zoho`.
- **Global overrides:** `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_USE_TLS`, `EMAIL_USE_SSL`, `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD`, `DEFAULT_FROM_EMAIL`.
- **Provider-specific overrides (checked first by the health check):**
  - Mailjet: `MAILJET_EMAIL_HOST`, `MAILJET_EMAIL_PORT`, `MAILJET_EMAIL_USE_TLS`, `MAILJET_EMAIL_USE_SSL`, `MAILJET_EMAIL_HOST_USER`, `MAILJET_EMAIL_HOST_PASSWORD`.
  - Zoho: `ZOHO_EMAIL_HOST`, `ZOHO_EMAIL_PORT`, `ZOHO_EMAIL_USE_TLS`, `ZOHO_EMAIL_USE_SSL`, `ZOHO_EMAIL_HOST_USER`, `ZOHO_EMAIL_HOST_PASSWORD`.
- **Health check recipient:** `EMAIL_HEALTHCHECK_RECIPIENT` (or pass `--to`).


==========================
==========================
## SMTP health check

Send a disposable test email through every configured provider:

```bash
python manage.py send_email_healthcheck --to someone+test@example.com
```

You can target one backend with `--provider mailjet` or `--provider zoho`. The command uses provider-prefixed environment variables first, then falls back to global `EMAIL_*` values.

==========================
==========================
## Checkout email flow verification

- Run tests for the email provider parsing and checkout confirmation flow:

```bash
python manage.py test hr_email hr_shop
```

- When exercising the flow manually, watch the server logs for rate-limit warnings emitted from `hr_shop/services/email_confirmation.py` if you trigger multiple sends in a short window.

 ==========================================================================================================
