{# hr_common/templates/hr_common/base.html #}

{% load django_vite %}
{% load static %}

<!DOCTYPE html>
<!--suppress CheckEmptyScriptTag -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta name="description" content="Hella Webtilian!">

    <title>{% block title %}Hella Reptilian{% endblock %}</title>

<link rel="preload"
      as="image"
      href="{% static 'hr_core/images/backgrounds/bg_opt/parallax_bg_1-0-1920w.webp' %}"
      imagesrcset="{% static 'hr_core/images/backgrounds/bg_opt/parallax_bg_1-0-960w.webp' %} 960w,
                   {% static 'hr_core/images/backgrounds/bg_opt/parallax_bg_1-0-1920w.webp' %} 1920w"
      imagesizes="100vw"
      fetchpriority="high">


    <link rel="preload"
          href="{% static 'hr_core/fonts/Exo2-VariableFont_wght.woff2' %}"
          as="font"
          type="font/woff2"
          crossorigin>

    <script>document.documentElement.classList.add("prepaint");</script>

    <link rel="icon" href="{% static 'icons/favicon-16.png' %}" sizes="16x16" type="image/png">
    <link rel="icon" href="{% static 'icons/favicon-32.png' %}" sizes="32x32" type="image/png">
    <link rel="icon" href="{% static 'icons/favicon-48.png' %}" sizes="48x48" type="image/png">
    <link rel="icon" href="{% static 'icons/apple-touch-icon.png' %}" sizes="180x180" type="image/png">
    <link rel="icon" href="{% static 'icons/favicon.ico' %}" type="image/x-icon">

    {% if debug|default:False %}
        {% vite_hmr_client %}
    {% endif %}

    {# Critical CSS - loads immediately, blocks render intentionally #}
    <link rel="stylesheet" href="{% vite_asset_url 'css/critical.css' %}">

    {# JS bundle #}
    {% vite_asset 'js/main.js' %}

    {# Noncritical CSS - Deferred, loaded w/ media="print" to not block initial render. Switched to media="all" on load to apply noncritical styles after first paint. #}
    <link rel="stylesheet"
          href="{% vite_asset_url 'css/noncritical.css' %}"
          media="print"
          onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="{% vite_asset_url 'css/noncritical.css' %}">
    </noscript>

    {% block extra_head %}{% endblock %}
</head>

<body style="background-color: black;" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>

<div id="global-message-bar" class="global-message-bar prehide" style="visibility: hidden;">
    <span id="global-message-content"></span>
</div>

<div id="intro-overlay" class="intro-overlay">
    <div class="intro-container">

        <div class="intro-logo-stack">

            <svg class="intro-logo-base" viewBox="0 0 200 200" aria-label="Hella Reptilian" style="opacity: 0.35;">
                {# Circle Border #}
                <circle cx="100" cy="100" r="92" fill="none" stroke="currentColor" stroke-width="2.5"/>

                {# Base H Strokes #}
                <rect x="59" y="60" width="8" height="70" fill="currentColor"/>
                <rect x="59" y="90" width="43" height="8" fill="currentColor"/>

                {# Base Crossbar #}
                <rect x="94" y="60" width="8" height="70" fill="currentColor"/>

                {# Base R Strokes #}
                <path d="M98,63 L118,63 Q138,63 138,80 Q138,94 118,94 L98,94 Z" fill="black" stroke-width="9"/>
                <path d="M102,94 L140,130" stroke="currentColor" stroke-width="8" stroke-linecap="butt" stroke-linejoin="bevel"/>

                {# Base Exclamation Tittle #}
                <rect x="94" y="60" width="8" height="70" rx="2" fill="currentColor"/>
                <circle cx="98" cy="145" r="6" fill="currentColor"/>
            </svg>

            {# Highlight H Strokes #}
            <svg class="intro-logo-highlight intro-logo-highlight-h" viewBox="0 0 200 200" aria-hidden="true">
                <circle cx="100" cy="100" r="92" fill="none" stroke="transparent" stroke-width="2.5"/>
                <rect x="59" y="60" width="8" height="70" fill="currentColor"/>
                <rect x="59" y="90" width="43" height="8" fill="currentColor"/>
            </svg>

            {# Highlight Crossbar #}
            <svg class="intro-logo-highlight intro-logo-highlight-center" viewBox="0 0 200 200" aria-hidden="true">
                <circle cx="100" cy="100" r="92" fill="none" stroke="transparent" stroke-width="2.5"/>
                <rect x="94" y="60" width="8" height="70" fill="currentColor"/>
            </svg>

            {# Highlight R Strokes #}
            <svg class="intro-logo-highlight intro-logo-highlight-r" viewBox="0 0 200 200" aria-hidden="true">
                <circle cx="100" cy="100" r="92" fill="none" stroke="transparent" stroke-width="2.5"/>
                <path d="M98,63 L118,63 Q138,63 138,80 Q138,94 118,94 L98,94 Z" fill="black" stroke-width="9"/>
                <path d="M102,94 L140,130" stroke="currentColor" stroke-width="8" stroke-linecap="butt" stroke-linejoin="miter"/>
            </svg>

            {# Highlight Exclamation Crossbar#}
            <svg class="intro-logo-highlight intro-logo-highlight-stroke" viewBox="0 0 200 200" aria-hidden="true">
                <circle cx="100" cy="100" r="92" fill="none" stroke="transparent" stroke-width="2.5"/>
                <rect x="94" y="60" width="8" height="70" rx="2" fill="currentColor"/>
            </svg>

            {# Highlight Exclamation Tittle #}
            <svg class="intro-logo-highlight intro-logo-highlight-dot" viewBox="0 0 200 200" aria-hidden="true">
                <circle cx="100" cy="100" r="92" fill="none" stroke="transparent" stroke-width="2.5"/>
                <circle cx="98" cy="145" r="6" fill="currentColor"/>
            </svg>
        </div>

        <div class="intro-name" id="introName">HELLA REPTILIAN!</div>
    </div>

</div>

<div id="parallax-wrapper">

    {# ---- Sidebar / Drawer ---- #}
    <div id="open-nav-btn-container" class="prehide" style="visibility:hidden;">
        <button class="rounded-lg text-sm p-1.5 top-2.5 left-0 inline-flex items-center z-40 fixed"
                id="nav-open-btn"
                type="button"
                data-drawer-target="drawer-navigation"
                data-drawer-show="drawer-navigation"
                aria-label="Open sidebar menu">
            <i class="fa-solid fa-bars"></i>
        </button>
    </div>

    <div id="drawer-navigation" class="prehide" style="visibility: hidden;" tabindex="-1">
        <button type="button"
                id="nav-close-btn"
                data-drawer-close
                class="rounded-lg text-sm p-1.5 top-2.5 right-2.5 inline-flex items-center relative">
            <i class="fa-regular fa-circle-xmark"></i>
            <span class="sr-only">Close menu</span>
        </button>

        <aside id="sidebar-access"
               hx-get="{% url 'hr_access:account_get_sidebar_panel' %}"
               hx-trigger="load, accessChanged from:body"
               hx-swap="innerHTML transition:true">
        </aside>

        <iframe data-src="https://bandcamp.com/EmbeddedPlayer/album=1766078263/size=large/bgcol=333333/linkcol=4ec5ec/tracklist=false/transparent=true/"
                class="bc-embed"
                width="360"
                height="480"
                loading="lazy"
                title="Bandcamp player: Into Hella We Ride! [Demo]"
                seamless>
            <a href="https://hellareptilian.bandcamp.com/album/into-hella-we-ride-demo">Into Hella We Ride! [Demo] by Hella Reptilian!</a>
        </iframe>
    </div>

    {# ---- Global Cart Icon w/ Item Counter #}
    <button id="floating-cart-btn"
            style="visibility: hidden;"
            class="prehide floating-cart-btn {% if cart_item_count|default:0 <= 0 %}is-hidden{% endif %}"
            type="button"
            aria-label="View Cart"
            hx-get="{% url 'hr_shop:checkout_resume' %}"
            hx-target="#modal-content"
            hx-swap="innerHTML transition:true">
        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
        <span id="floating-cart-count" class="floating-cart-count">
            {{ cart_item_count }}
        </span>
    </button>

    {# ---- Global modal shell ---- #}
    <div id="modal" class="prehide modal hidden product-modal" style="visibility:hidden;" aria-hidden="true">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-panel">
            <button class="modal-close-btn" data-modal-close>&times;</button>
            <div id="modal-message-box">
                <span id="modal-message-content"></span>
            </div>
            <div id="modal-content" hx-swap="innerHTML transition:true"></div>
        </div>
    </div>


    {% block content %}{% endblock %}

    <div id="modal-loader"
         hidden
         hx-trigger="hr:loadModal"
         hx-target="#modal-content"
         hx-swap="innerHTML transition:true">
    </div>

    {% block extra_scripts %}{% endblock %}

    {% if debug|default:False %}
        {% include "hr_common/_dev_browser_reload.html" %}
    {% endif %}

</div>
</body>
</html>
